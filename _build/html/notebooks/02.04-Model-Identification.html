
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2.4. Model Identification for the Temperature Control Lab &#8212; CBE 30338 Chemical Process Control</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Feedback Control" href="03.00-Feedback-Control.html" />
    <link rel="prev" title="2.3. First Order Model for a Single Heater" href="02.03-First-Order-Model-for-a-Single-Heater.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CBE 30338 Chemical Process Control</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Readme.html">
   CBE 30338 Chemical Process Control
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Course Information
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Schedule.html">
   Schedule
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Topical Materials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="01.00-What-is-Process-Control.html">
   1. What is Process Control?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="01.01-Elements-of-Feedback-Control.html">
     1.1. Elements of Process Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01.02-Examples-of-Process-Control.html">
     1.2. Examples of Process Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01.05-Assignment-1.html">
     1.3. Assignment 1
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="02.00-Process-Modeling.html">
   2. Process Modeling
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="02.01-Properties-of-Scalar-First-Order-Linear-Systems.html">
     2.1. Properties of Scalar First Order Linear Systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.02-One-Compartment-Pharmacokinetics.html">
     2.2. One Compartment Pharmacokinetics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02.03-First-Order-Model-for-a-Single-Heater.html">
     2.3. First Order Model for a Single Heater
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     2.4. Model Identification for the Temperature Control Lab
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="03.00-Feedback-Control.html">
   3. Feedback Control
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="03.01-Case-Study-Thermal-Cycling-PCR.html">
     3.1. Case Study: Thermal Cycling for PCR
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.02-Setpoints.html">
     3.2. Setpoints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.03-Relay-Control.html">
     3.3. Relay Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.04-Implementing-Controllers.html">
     3.4. Implementing Controllers in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.05-Proportional-Integral-Control.html">
     3.5. Practical Proportional (P) and Proportional-Integral (PI) Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.06-Lab-Assignment-PI-Control.html">
     3.6. Lab Assignment 3: Relay and PI Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.07-Integral-Windup-and-Bumpless-Transfer.html">
     3.7. Integral Windup and Bumpless Transfer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.08-Lab-Assignment-Cascade-Control.html">
     3.8. Lab Assignment 4: Cascade Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03.09-Lab-Assignment-Solution.html">
     3.9. Lab Assignment 4: Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="04.00-Process-Analytics.html">
   4. Process Analytics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="04.01-Learning-Goals.html">
     4.1. Learning Goals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.02-Process-Historians.html">
     4.2. Data/Process/Operational Historian
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.03-State-Estimation-Copy1.html">
     4.3. Estimation and Anamoly Detection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.03-State-Estimation.html">
     4.4. State Estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.04-Lab-Assigment-State-Estimation.html">
     4.5. Lab Assignment 5: State Estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.05-Anomaly-Detection.html">
     4.6. Anomaly Detection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.06-Lab-Assignment-Anomaly-Detection.html">
     4.7. Lab Assignment 6: Anomaly Detection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.07-Observer-Synthesis-LMI.html">
     4.8. Observer Synthesis using Linear Matrix Inequalities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.08-Envrironmental-Application.html">
     4.9. Application of Luenberger Observers to Environmental Modeling of Rivers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04.09-Study-Questions.html">
     4.10. Study Questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="05.00-Optimization.html">
   5. Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="05.01-Linear-Production-Model.html">
     5.1. Linear Production Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.02-Linear-Blending-Problem.html">
     5.2. Linear Blending Problems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.03-Homework_4.html">
     5.3. Homework Assignment 4
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.04-Gasoline-Blending.html">
     5.4. Gasoline Blending
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.05-Linear-Programming.html">
     5.5. Linear Programming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.06-Design-of-a-Cold-Weather-Fuel.html">
     5.6. Design of a Cold Weather Fuel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.98-Linear-Production-Model-in-Pyomo.html">
     5.7. Linear Production Model in Pyomo
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05.99-Pyomo-Examples.html">
     5.8. Pyomo Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="06.00-Predictive-Control.html">
   6. Predictive Control
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="06.01-Static-Operability.html">
     6.1. Static Operability
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.02-Simulation-and-Open-Loop-Optimal-Control.html">
     6.2. Simulation and Open-Loop Optimal Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.03-Predictive-Control.html">
     6.3. Predictive Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.04-Implementing-Predictive-Control.html">
     6.4. Implementing Predictive Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06.05-Quiz-Review.html">
     6.5. Quiz Review for Chapters 5 and 6
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="07.00-Discrete-Event-Systems.html">
   7. Discrete Event Systems
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="07.01-Introduction-to-Simpy.html">
     7.1. Introduction to Simpy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.02-Agent-Based-Models.html">
     7.2. Agent Based Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.03-Chemotaxis.html">
     7.3. Chemotaxis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.04-Project-Batch-Chemical-Process.html">
     7.4. Batch Chemical Process
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07.05-Queuing-Systems-and-Poisson-Processes.html">
     7.5. Simulating Queuing Systems
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08.00-Projects.html">
   8. Projects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09.00-Bibliography.html">
   9. References
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Control Laboratory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tclab/01.00-TCLab.html">
   1. The Temperature Control Laboratory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/01.01-TCLab-Hardware.html">
     1.1. TCLab Hardware Setup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/01.02-TCLab-Software.html">
     1.2. TCLab Software Setup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/01.03-TCLab-Usage.html">
     1.3. TCLab Usage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/01.04-Lab-1.html">
     1.4. Lab Assignment: Coding a Relay Controller
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/A.01-TCLab.html">
     1.5. Geting Started with the Temperature Control Laboratory
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tclab/02.00-Empirical-Model-Identification.html">
   2. Empirical Model Identification
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/02.01-Step-Testing.html">
     2.1. Step Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/02.02-Fitting-Step-Test-Data-to-Empirical-Models.html">
     2.2. Fitting Step Test Data to Empirical Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/02.03-First-Order-Model-for-a-Single-Heater.html">
     2.3. First Order Model for a Single Heater
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tclab/03.00-Estimating-Model-Parameters.html">
   3. Estimating Model Parameters
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/03.04-Two-Input-Two-Output-Model.html">
     3.1. Two-Input, Two-Output Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/03.05-Two-State-Model-for-a-Single-Heater.html">
     3.2. Two State Model for a Single Heater
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/03.06-Four-State-Model.html">
     3.3. Four State Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/03.10-TCLab-Lab-2-Model-Indentification-Solutions.html">
     3.4. TCLab Lab 2: Model Identification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/03.10-TCLab-Lab-2-Model-Indentification.html">
     3.5. TCLab Lab 2: Model Identification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/03.11-TCLab-Lab-2-Fitting.html">
     3.6. Model Identification: Fitting models to data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tclab/04.00-Feedback-Control.html">
   4. Feedback Control
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/04.01-Relay-Control.html">
     4.1. Relay Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/04.03-PID_Control.html">
     4.2. PID Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/04.10-Lab-Assignment-PID-Control.html">
     4.3. Lab Assignment: PID Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/04.11-Lab-Assignment-PI-Control.html">
     4.4. Lab Assignment 4: PI Control
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tclab/05.00-State-Estimation.html">
   5. State Estimation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/05.01-Open-and-Closed-Loop-Estimation.html">
     5.2. Open and Closed Loop Estimation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tclab/06.00-Optimal-Control.html">
   6. Optimization
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tclab/07.00-Predictive-Control-and-Real-Time-Optimization.html">
   7. Predictive Control and Real Time Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/07.01-Optimization-Control-and-Estimation-using-Pyomo.html">
     7.1. Simulation, Control, and Estimation using Pyomo
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tclab/07.02-Optimization-Control-and-Estimation-using-Pyomo-With-Windows-ipopt.html">
     7.2. Simulation, Control, and Estimation using Pyomo
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../python/B.00-Python-Tutorials.html">
   Python Tutorials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/B.10-Animation-in-Jupyter-Notebooks.html">
     Animation in Jupyter Notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/A.01-Coding-Controllers-with-Python-Generators.html">
     Coding Controllers with Python Generators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/A.02-Modular-Approach-to-Simulation-using-Python-Generators.html">
     Modular Simulation using Python Generators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/A.03-Modular-Simulation-using-Python-Generators.html">
     A Modular Approach to Simulation using Python Generators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../python/A.04-Animation-in-Jupyter-Notebooks.html">
     Animation in Jupyter Notebooks
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/02.04-Model-Identification.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/jckantor/cbe30338-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/jckantor/cbe30338-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/02.04-Model-Identification.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/jckantor/cbe30338-book/main?urlpath=tree/notebooks/02.04-Model-Identification.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/jckantor/cbe30338-book/blob/main/notebooks/02.04-Model-Identification.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accessing-experimental-data">
   2.4.1. Accessing experimental data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-data-into-a-pandas-dataframe">
     2.4.1.1. Read data into a Pandas DataFrame
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-experimental-data-to-model-predictions">
   2.4.2. Comparing experimental data to model predictions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#empirical-modeling">
   2.4.3. Empirical Modeling
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#first-order-gain-and-time-constant">
     2.4.3.1. First order gain and time constant
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#first-order-with-time-delay">
     2.4.3.2. First order with time delay
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#first-order-energy-balance-model">
   2.4.4. First order Energy balance model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-the-best-fit">
   2.4.5. Find the best fit
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#second-order-model">
   2.4.6. Second-order model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamics-of-the-heater-sensor-system">
     2.4.6.1. Dynamics of the Heater/Sensor System
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#best-fit">
     2.4.6.2. Best fit
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fourth-order-multi-input-multi-output-model">
   2.4.7. Fourth-Order Multi-Input Multi-Output Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-derivation">
     2.4.7.1. Model derivation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#standard-form">
     2.4.7.2. Standard form
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lab-assignment-2-identification-of-a-multi-input-multi-output-model-for-the-temperature-control-laboratory">
   2.4.8. Lab Assignment 2: Identification of a Multi-input, Multi-output Model for the Temperature Control Laboratory
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-1">
     2.4.8.1. Exercise 1.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-2">
     2.4.8.2. Exercise 2.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-3">
     2.4.8.3. Exercise 3.
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="model-identification-for-the-temperature-control-lab">
<h1><span class="section-number">2.4. </span>Model Identification for the Temperature Control Lab<a class="headerlink" href="#model-identification-for-the-temperature-control-lab" title="Permalink to this headline">¶</a></h1>
<p>Models are essential for feedback control. It may be difficult to understand where and how the model was incorporated into the control system design, and the model may be just a simplistic cause-and-effect understanding of process operation, but be assured that somewhere in the control system is an embedded understanding of process operation.</p>
<p>The notebook is deep dive in creating models for the dynamic response of the Temperature Control Lab to power inputs and external disturbances. The survey of models include:</p>
<ul class="simple">
<li><p>Empirical models, single-input single-output</p>
<ul>
<li><p>Linear first-order</p></li>
<li><p>Linear first-order with dead-time</p></li>
</ul>
</li>
<li><p>Energy balance models</p>
<ul>
<li><p>Single-input, single-output</p>
<ul>
<li><p>First order</p></li>
<li><p>Second order</p></li>
</ul>
</li>
<li><p>Multi-input, multi-output</p>
<ul>
<li><p>Fourth order</p></li>
</ul>
</li>
</ul>
</li>
<li><p>State space models</p></li>
</ul>
<div class="section" id="accessing-experimental-data">
<h2><span class="section-number">2.4.1. </span>Accessing experimental data<a class="headerlink" href="#accessing-experimental-data" title="Permalink to this headline">¶</a></h2>
<p>Data acquired through normal process operation or experimentation will normally be accessed from a process database. Here we demonstrate reading data stored previously stored in a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file by a process historian.</p>
<div class="section" id="read-data-into-a-pandas-dataframe">
<h3><span class="section-number">2.4.1.1. </span>Read data into a Pandas DataFrame<a class="headerlink" href="#read-data-into-a-pandas-dataframe" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/">Pandas</a> is one of the most important and widely used Python libraries for data analysis and manipulation. Here we use the library to access a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file containing previously collected data from a step test of the Temperature Control Lab.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">least_squares</span>

<span class="c1"># read data file from the Github repository into a Pandas dataframe</span>
<span class="n">data_location</span> <span class="o">=</span> <span class="s2">&quot;https://jckantor.github.io/cbe30338-2021/data/Model_Data.csv&quot;</span>
<span class="n">expt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_location</span><span class="p">)</span>

<span class="c1"># set time index</span>
<span class="n">expt</span> <span class="o">=</span> <span class="n">expt</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">t_expt</span> <span class="o">=</span> <span class="n">expt</span><span class="o">.</span><span class="n">index</span>

<span class="c1"># display data in tabular format</span>
<span class="n">display</span><span class="p">(</span><span class="n">expt</span><span class="p">)</span>

<span class="c1"># simple plotting</span>
<span class="n">expt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time / seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>T1</th>
      <th>T2</th>
      <th>Q1</th>
      <th>Q2</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>21.221</td>
      <td>21.446</td>
      <td>50.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>10.0</th>
      <td>21.253</td>
      <td>21.511</td>
      <td>50.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>20.0</th>
      <td>22.188</td>
      <td>21.575</td>
      <td>50.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>30.0</th>
      <td>23.477</td>
      <td>21.672</td>
      <td>50.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>40.0</th>
      <td>24.991</td>
      <td>21.897</td>
      <td>50.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>560.0</th>
      <td>52.803</td>
      <td>36.722</td>
      <td>50.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>570.0</th>
      <td>52.803</td>
      <td>36.786</td>
      <td>50.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>580.0</th>
      <td>52.803</td>
      <td>36.754</td>
      <td>50.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>590.0</th>
      <td>53.028</td>
      <td>37.012</td>
      <td>50.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>600.0</th>
      <td>52.642</td>
      <td>36.947</td>
      <td>50.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>61 rows × 4 columns</p>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;time / seconds&#39;&gt;
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_3_2.png" src="../_images/02.04-Model-Identification_3_2.png" />
</div>
</div>
<hr>
<p><strong>Study Question:</strong>  “Break free from Excel”. This exercise demonstrates a technique that you may find useful in your other coursework, particularly the Junior and Senior lab courses. The code cell below contains a link that will export <a class="reference external" href="https://docs.google.com/spreadsheets/d/1rV_oimh-GCYNP-xRP1HNrLvh7P4jZBSmwuqG3VPIaB0/edit?usp=sharing">data stored in a Google Sheet</a> as a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file. The file was previously created and share access set for viewing by anyone with a link. Use the Pandas library to read the data into a data frame, display the data table, set the data frame index to the column labeled <code class="docutils literal notranslate"><span class="pre">Time</span></code>, and plot the data.</p>
<hr><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">google_sheet_id</span> <span class="o">=</span> <span class="s2">&quot;1rV_oimh-GCYNP-xRP1HNrLvh7P4jZBSmwuqG3VPIaB0&quot;</span>
<span class="n">google_csv_download</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://docs.google.com/spreadsheets/d/</span><span class="si">{</span><span class="n">google_sheet_id</span><span class="si">}</span><span class="s2">/gviz/tq?tqx=out:csv&quot;</span>

<span class="c1"># write your code here</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="comparing-experimental-data-to-model-predictions">
<h2><span class="section-number">2.4.2. </span>Comparing experimental data to model predictions<a class="headerlink" href="#comparing-experimental-data-to-model-predictions" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a function to compare two data sets</span>
<span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
    <span class="n">t_expt</span> <span class="o">=</span> <span class="n">expt</span><span class="o">.</span><span class="n">index</span>
    
    <span class="c1"># create a 3 x 1 grid of plot axes</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    
    <span class="c1"># first plot axes</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t_expt</span><span class="p">,</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;T1 expt&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t_expt</span><span class="p">,</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;T2&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;T2 expt&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;T1 pred&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T2&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;T2 pred&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;deg C&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;temperature response&quot;</span><span class="p">)</span>

    <span class="c1"># second plot axes</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t_expt</span><span class="p">,</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;Q1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Q1 expt&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t_expt</span><span class="p">,</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;Q2&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Q2 expt&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;Q1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Q1 pred&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;Q2&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Q2 pred&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;percent&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;heater power&quot;</span><span class="p">)</span>
    
    <span class="c1"># third plot axes</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">expt</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;T1 error&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T2&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">expt</span><span class="p">[</span><span class="s2">&quot;T2&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;T1 error&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;residuals&quot;</span><span class="p">)</span>
    
    <span class="c1"># things to do for every plot axes</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time / seconds&quot;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="k">return</span>
    
<span class="c1"># demonstrate by comparing experimental data to itself</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">expt</span><span class="p">,</span> <span class="n">expt</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02.04-Model-Identification_7_0.png" src="../_images/02.04-Model-Identification_7_0.png" />
</div>
</div>
</div>
<div class="section" id="empirical-modeling">
<h2><span class="section-number">2.4.3. </span>Empirical Modeling<a class="headerlink" href="#empirical-modeling" title="Permalink to this headline">¶</a></h2>
<div class="section" id="first-order-gain-and-time-constant">
<h3><span class="section-number">2.4.3.1. </span>First order gain and time constant<a class="headerlink" href="#first-order-gain-and-time-constant" title="Permalink to this headline">¶</a></h3>
<p>We previously derived a model for the response T1 of the Temperature Control Lab to a constant input <span class="math notranslate nohighlight">\(\bar{u}_1\)</span> as</p>
<div class="math notranslate nohighlight">
\[\frac{dT_1}{dt} = -\frac{1}{\tau}(T_1 - T_{amb})+ \frac{K}{\tau}\bar{u}_1\]</div>
<p>where the gain <span class="math notranslate nohighlight">\(K\)</span> and the time constant <span class="math notranslate nohighlight">\(\tau\)</span> are given by the</p>
<p>\begin{align}
\tau = \frac{C_p}{U_a} \qquad
K = \frac{\alpha P_1}{U_a}
\end{align}</p>
<p>Assuming the system starts with an initial condition <span class="math notranslate nohighlight">\(T_1(0) = T_{amb}\)</span>, the solution to the differential equation of the system is</p>
<p>\begin{align}
T_1(t) &amp; = T_{amb}  + K\bar{u}_{1}(1 - e^{-(t-t_0)/\tau})
\end{align}</p>
<p>Given estimates of <span class="math notranslate nohighlight">\(K\)</span> and <span class="math notranslate nohighlight">\(\tau\)</span>, we can construct the preedicted response and compare to the experimental observed response.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># known parameters</span>
<span class="n">T_amb</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">u1bar</span> <span class="o">=</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;Q1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">t_expt</span> <span class="o">=</span> <span class="n">expt</span><span class="o">.</span><span class="n">index</span>

<span class="c1"># adjustable model parameters</span>
<span class="n">K</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># create function to create predictions and return residuals</span>
<span class="k">def</span> <span class="nf">model_first_order</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># unpack list of parameters into variables</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">param</span>
    
    <span class="c1"># create empty prediction data frame</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">,</span> <span class="s2">&quot;T2&quot;</span><span class="p">,</span> <span class="s2">&quot;Q1&quot;</span><span class="p">,</span> <span class="s2">&quot;Q2&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">t_expt</span><span class="p">)</span>
    
    <span class="c1"># calculation prediction</span>
    <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">T_amb</span> <span class="o">+</span> <span class="n">K</span><span class="o">*</span><span class="n">u1bar</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_expt</span><span class="o">/</span><span class="n">tau</span><span class="p">))</span>
    
    <span class="c1"># plot if desired</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plot_data</span><span class="p">(</span><span class="n">expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
        
    <span class="c1"># return residual difference between prediction and experiment</span>
    <span class="k">return</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span>

<span class="c1"># compare prediction to experiment</span>
<span class="n">model_first_order</span><span class="p">([</span><span class="n">K</span><span class="p">,</span> <span class="n">tau</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time
0.0     -0.221000
10.0     2.126065
20.0     3.343731
30.0     4.002544
40.0     4.250999
           ...   
560.0   -6.895447
570.0   -6.886649
580.0   -6.878689
590.0   -7.096486
600.0   -6.703969
Name: T1, Length: 61, dtype: float64
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_10_1.png" src="../_images/02.04-Model-Identification_10_1.png" />
</div>
</div>
<hr>
<p><strong>Study Question:</strong> By trial and error, attempt to find values for the gain <span class="math notranslate nohighlight">\(K\)</span> and time constant <span class="math notranslate nohighlight">\(\tau\)</span> that provide a useful prediction of the experimentally measured response.</p>
<hr><p>Obviously, it would useful to have some way of finding ‘optimal’ values for <span class="math notranslate nohighlight">\(K\)</span> and <span class="math notranslate nohighlight">\(\tau\)</span>. In this cell we use the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.least_squares.html"><code class="docutils literal notranslate"><span class="pre">least_squares</span></code></a> routine from <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code> to find optimal values of the parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">model_first_order</span><span class="p">,</span>  <span class="p">[</span><span class="n">K</span><span class="p">,</span> <span class="n">tau</span><span class="p">])</span>
<span class="n">K</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">x</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;K = </span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">,  tau = </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">model_first_order</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>K = 0.6810786742351254,  tau = 196.3595429520904
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time
0.0     -0.221000
10.0     1.437844
20.0     2.109734
30.0     2.347839
40.0     2.285121
           ...   
560.0    0.284868
570.0    0.382487
580.0    0.475259
590.0    0.338425
600.0    0.808213
Name: T1, Length: 61, dtype: float64
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_13_2.png" src="../_images/02.04-Model-Identification_13_2.png" />
</div>
</div>
</div>
<div class="section" id="first-order-with-time-delay">
<h3><span class="section-number">2.4.3.2. </span>First order with time delay<a class="headerlink" href="#first-order-with-time-delay" title="Permalink to this headline">¶</a></h3>
<p>A first-order with time delay (or ‘dead time’) are frequenty used in process control to model the delitreous</p>
<p>\begin{align}
T_1(t) &amp; = T_{amb}  + K\bar{u}<em>{1}(1 - e^{-(t-t</em>{delay})/\tau})
\end{align}</p>
<div class="math notranslate nohighlight">
\[\frac{dT_1}{dt} = -\frac{1}{\tau}T_1 + \frac{K}{\tau}u_1(t-t_{delay}) + \frac{1}{\tau}T_{amb}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameter values and units</span>
<span class="n">T_amb</span> <span class="o">=</span> <span class="mi">21</span>                 <span class="c1"># deg C</span>
<span class="n">u1bar</span> <span class="o">=</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;Q1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">t_expt</span> <span class="o">=</span> <span class="n">expt</span><span class="o">.</span><span class="n">index</span>

<span class="c1"># adjustable parameters</span>
<span class="n">K</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">t_delay</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">def</span> <span class="nf">model_first_order_delay</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">t_delay</span> <span class="o">=</span> <span class="n">param</span>    
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">,</span> <span class="s2">&quot;T2&quot;</span><span class="p">,</span> <span class="s2">&quot;Q1&quot;</span><span class="p">,</span> <span class="s2">&quot;Q2&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">t_expt</span><span class="p">)</span>
    <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">T_amb</span> <span class="o">+</span> <span class="n">K</span><span class="o">*</span><span class="n">u1bar</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t_delay</span><span class="p">)</span><span class="o">/</span><span class="n">tau</span><span class="p">))</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">t_delay</span> <span class="k">else</span> <span class="n">T_amb</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_expt</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plot_data</span><span class="p">(</span><span class="n">expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span>
    
<span class="n">model_first_order_delay</span><span class="p">([</span><span class="n">K</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">t_delay</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time
0.0     -0.221000
10.0    -0.253000
20.0     0.746790
30.0     1.267800
40.0     1.447077
           ...   
560.0   -2.569846
570.0   -2.520390
580.0   -2.474123
590.0   -2.655840
600.0   -2.229349
Name: T1, Length: 61, dtype: float64
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_15_1.png" src="../_images/02.04-Model-Identification_15_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">model_first_order_delay</span><span class="p">,</span>  <span class="p">[</span><span class="n">K</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">t_delay</span><span class="p">])</span>
<span class="n">K</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">t_delay</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">x</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;K = </span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">,  tau = </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2">, time delay = </span><span class="si">{</span><span class="n">t_delay</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">model_first_order_delay</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>K = 0.6520728533493453,  tau = 154.47860579512735, time delay = 21.772054298276494
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time
0.0     -0.221000
10.0    -0.253000
20.0    -1.188000
30.0    -0.785879
40.0    -0.362185
           ...   
560.0   -0.199623
570.0   -0.136923
580.0   -0.078154
590.0   -0.248068
600.0    0.189565
Name: T1, Length: 61, dtype: float64
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_16_2.png" src="../_images/02.04-Model-Identification_16_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="first-order-energy-balance-model">
<h2><span class="section-number">2.4.4. </span>First order Energy balance model<a class="headerlink" href="#first-order-energy-balance-model" title="Permalink to this headline">¶</a></h2>
<p>We previously developed a model comprising a single differential equation for the temperature response of a heater/sensor assembly. Given <span class="math notranslate nohighlight">\(u_1(t)\)</span> and an initial condition <span class="math notranslate nohighlight">\(T_{amb}\)</span>, the heater/sensor temperature is given by</p>
<div class="math notranslate nohighlight">
\[\frac{dT_1}{dt} = -\frac{U_a}{C_p}T_1 + \frac{\alpha P_1}{C_p} u_1(t) + \frac{U_a}{C_p}T_{amb}\]</div>
<p>Several of the key parameters are known. These include <span class="math notranslate nohighlight">\(\alpha\)</span> which was determined by direct measurement, <span class="math notranslate nohighlight">\(P1\)</span> which is set in the Arduino firmware. We  assume the ambient temperature <span class="math notranslate nohighlight">\(T_{amb}\)</span> is measurable and known.</p>
<p>The unknown parameters are the heat capacity <span class="math notranslate nohighlight">\(C_p\)</span> and heat transfer coefficient <span class="math notranslate nohighlight">\(U_a\)</span>. We wish to find values of the unknown parameters that allow the model response to mimic responses measured by experiment.</p>
<p>Here we show a simulation of this model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameter values and units</span>
<span class="n">T_amb</span> <span class="o">=</span> <span class="mi">21</span>             <span class="c1"># deg C</span>
<span class="n">P1</span> <span class="o">=</span> <span class="mi">200</span>               <span class="c1"># P1 units</span>
<span class="n">P2</span> <span class="o">=</span> <span class="mi">100</span>               <span class="c1"># P2 units</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.00016</span>        <span class="c1"># watts / (units P1 * percent U1)</span>

<span class="c1"># input function</span>
<span class="k">def</span> <span class="nf">u1</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t_expt</span><span class="p">,</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;Q1&quot;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">u2</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t_expt</span><span class="p">,</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;Q2&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The unknown parameters are the heat capacity <span class="math notranslate nohighlight">\(C_p\)</span> and heat transfer coefficient <span class="math notranslate nohighlight">\(U_a\)</span>. We wish to find values of the unknown parameters that allow the model response to mimic responses measured by experiment.</p>
<p>Here we show a simulation of this model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>

<span class="c1"># adjustable parameters</span>
<span class="n">Cp</span> <span class="o">=</span> <span class="mi">6</span>                 <span class="c1"># joules/deg C</span>
<span class="n">Ua</span> <span class="o">=</span> <span class="mf">0.05</span>              <span class="c1"># watts/deg C</span>

<span class="k">def</span> <span class="nf">model_energy_first_order</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># unpack the adjustable parameters</span>
    <span class="n">Cp</span><span class="p">,</span> <span class="n">Ua</span> <span class="o">=</span> <span class="n">param</span>

    <span class="c1"># model solution</span>
    <span class="k">def</span> <span class="nf">deriv</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">T1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">Ua</span><span class="o">/</span><span class="n">Cp</span><span class="p">)</span><span class="o">*</span><span class="n">T1</span> <span class="o">+</span> <span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">P1</span><span class="o">/</span><span class="n">Cp</span><span class="p">)</span><span class="o">*</span><span class="n">u1</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ua</span><span class="o">/</span><span class="n">Cp</span><span class="p">)</span><span class="o">*</span><span class="n">T_amb</span>

    <span class="n">soln</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">deriv</span><span class="p">,</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">t_expt</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">t_expt</span><span class="p">)],</span> <span class="p">[</span><span class="n">T_amb</span><span class="p">],</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">t_expt</span><span class="p">)</span> 
    
    <span class="c1"># create dataframe with predictions</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">,</span> <span class="s2">&quot;T2&quot;</span><span class="p">,</span> <span class="s2">&quot;Q1&quot;</span><span class="p">,</span> <span class="s2">&quot;Q2&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">t_expt</span><span class="p">)</span>
    <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># plot solution</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plot_data</span><span class="p">(</span><span class="n">expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span>
    
<span class="n">model_energy_first_order</span><span class="p">([</span><span class="n">Cp</span><span class="p">,</span> <span class="n">Ua</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time
0.0     -0.221000
10.0     2.305582
20.0     3.724586
30.0     4.601597
40.0     5.082666
           ...   
560.0   -0.111357
570.0   -0.086947
580.0   -0.064244
590.0   -0.268356
600.0    0.136861
Name: T1, Length: 61, dtype: float64
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_20_1.png" src="../_images/02.04-Model-Identification_20_1.png" />
</div>
</div>
</div>
<div class="section" id="find-the-best-fit">
<h2><span class="section-number">2.4.5. </span>Find the best fit<a class="headerlink" href="#find-the-best-fit" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">model_energy_first_order</span><span class="p">,</span>  <span class="p">[</span><span class="n">Cp</span><span class="p">,</span> <span class="n">Ua</span><span class="p">])</span>
<span class="n">Cp</span><span class="p">,</span> <span class="n">Ua</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">x</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cp = </span><span class="si">{</span><span class="n">Cp</span><span class="si">}</span><span class="s2">,  Ua = </span><span class="si">{</span><span class="n">Ua</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">model_energy_first_order</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cp = 9.229886459160445,  Ua = 0.046971454569863326
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time
0.0     -0.221000
10.0     1.437129
20.0     2.108398
30.0     2.345976
40.0     2.283637
           ...   
560.0    0.285965
570.0    0.382852
580.0    0.475093
590.0    0.338030
600.0    0.808000
Name: T1, Length: 61, dtype: float64
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_22_2.png" src="../_images/02.04-Model-Identification_22_2.png" />
</div>
</div>
</div>
<div class="section" id="second-order-model">
<h2><span class="section-number">2.4.6. </span>Second-order model<a class="headerlink" href="#second-order-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dynamics-of-the-heater-sensor-system">
<h3><span class="section-number">2.4.6.1. </span>Dynamics of the Heater/Sensor System<a class="headerlink" href="#dynamics-of-the-heater-sensor-system" title="Permalink to this headline">¶</a></h3>
<p>The previous results are not yet fully satisfactory. We’re still missing the initial ‘lag’ in response of the measured temperature.</p>
<p>For this third model, we consider the possibility that the heater and sensor may not be at the same temperature. In other words, that the heater/sensor assembly is not at a uniform temperature. To account for this possibility, we introduce <span class="math notranslate nohighlight">\(T_{H,1}\)</span> to denote the temperature of heater one and <span class="math notranslate nohighlight">\(T_{S,1}\)</span> to denote the temperature of the corresponding sensor. We’ll further assume that sensor mainly exchanges heat with the heater, and the dominant heat transfer to the surroundings is through the heat sink attached to the heater.</p>
<p>This motivates a model</p>
<p>\begin{align}
C^H_p\frac{dT_{H,1}}{dt} &amp; = U_a(T_{amb} - T_{H,1}) + U_b(T_{S,1} - T_{H,1}) + \alpha P_1u_1\
C^S_p\frac{dT_{S,1}}{dt} &amp; = U_b(T_{H,1} - T_{S,1})
\end{align}</p>
<p>where <span class="math notranslate nohighlight">\(C^H_p\)</span> and <span class="math notranslate nohighlight">\(C^S_p\)</span> are the gross heat capacities of the heater and sensor, respectively, and <span class="math notranslate nohighlight">\(U_b\)</span> is a new heat transfer coefficient characterizing the exchange of heat between the heater and sensor.</p>
<p>\begin{align}
\frac{dT_{H,1}}{dt} &amp; = -\frac{U_a+U_b}{C^H_p}T_{H,1} + \frac{U_b}{C^H_p}T_{S,1} + \frac{\alpha P_1}{C^H_p}u_1 + \frac{U_a}{C^H_p}T_{amb}\
\frac{dT_{S,1}}{dt} &amp; = \frac{U_b}{C^S_p}(T_{H,1} - T_{S,1})
\end{align}</p>
<p>Where measured temperature, that is, the temperature recorded by the Arduino, <span class="math notranslate nohighlight">\(T_1\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[T_1 = T_{S,1}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>

<span class="c1"># adjustable parameters</span>
<span class="n">CpH</span> <span class="o">=</span> <span class="mi">5</span>                <span class="c1"># joules/deg C</span>
<span class="n">CpS</span> <span class="o">=</span> <span class="mi">1</span>                <span class="c1"># joules/deg C</span>
<span class="n">Ua</span> <span class="o">=</span> <span class="mf">0.05</span>              <span class="c1"># watts/deg C</span>
<span class="n">Ub</span> <span class="o">=</span> <span class="mf">0.05</span>              <span class="c1"># watts/deg C</span>


<span class="k">def</span> <span class="nf">model_energy_second_order</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># unpack the adjustable parameters</span>
    <span class="n">CpH</span><span class="p">,</span> <span class="n">CpS</span><span class="p">,</span> <span class="n">Ua</span><span class="p">,</span> <span class="n">Ub</span> <span class="o">=</span> <span class="n">param</span>

    <span class="c1"># model solution</span>
    <span class="k">def</span> <span class="nf">deriv</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">T1H</span><span class="p">,</span> <span class="n">T1S</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">dT1H</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ua</span> <span class="o">+</span> <span class="n">Ub</span><span class="p">)</span><span class="o">*</span><span class="n">T1H</span> <span class="o">+</span> <span class="n">Ub</span><span class="o">*</span><span class="n">T1S</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">P1</span><span class="o">*</span><span class="n">u1</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">Ua</span><span class="o">*</span><span class="n">T_amb</span><span class="p">)</span><span class="o">/</span><span class="n">CpH</span>
        <span class="n">dT1S</span> <span class="o">=</span> <span class="n">Ub</span><span class="o">*</span><span class="p">(</span><span class="n">T1H</span> <span class="o">-</span> <span class="n">T1S</span><span class="p">)</span><span class="o">/</span><span class="n">CpS</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">dT1H</span><span class="p">,</span> <span class="n">dT1S</span><span class="p">]</span>

    <span class="n">soln</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">deriv</span><span class="p">,</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">t_expt</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">t_expt</span><span class="p">)],</span> <span class="p">[</span><span class="n">T_amb</span><span class="p">,</span> <span class="n">T_amb</span><span class="p">],</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">t_expt</span><span class="p">)</span> 
    
    <span class="c1"># create dataframe with predictions</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">,</span> <span class="s2">&quot;T2&quot;</span><span class="p">,</span> <span class="s2">&quot;Q1&quot;</span><span class="p">,</span> <span class="s2">&quot;Q2&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">t_expt</span><span class="p">)</span>
    <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># plot solution</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_data</span><span class="p">(</span><span class="n">expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span>
    
<span class="n">model_energy_second_order</span><span class="p">([</span><span class="n">CpH</span><span class="p">,</span> <span class="n">CpS</span><span class="p">,</span> <span class="n">Ua</span><span class="p">,</span> <span class="n">Ub</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time
0.0     -0.221000
10.0     0.371773
20.0     0.895562
30.0     1.395004
40.0     1.774688
           ...   
560.0   -0.210368
570.0   -0.188967
580.0   -0.148499
590.0   -0.323733
600.0    0.093363
Name: T1, Length: 61, dtype: float64
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_25_1.png" src="../_images/02.04-Model-Identification_25_1.png" />
</div>
</div>
</div>
<div class="section" id="best-fit">
<h3><span class="section-number">2.4.6.2. </span>Best fit<a class="headerlink" href="#best-fit" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">model_energy_second_order</span><span class="p">,</span>  <span class="p">[</span><span class="n">CpH</span><span class="p">,</span> <span class="n">CpS</span><span class="p">,</span> <span class="n">Ua</span><span class="p">,</span> <span class="n">Ub</span><span class="p">])</span>
<span class="n">CpH</span><span class="p">,</span> <span class="n">CpS</span><span class="p">,</span> <span class="n">Ua</span><span class="p">,</span> <span class="n">Ub</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">x</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CpH = </span><span class="si">{</span><span class="n">CpH</span><span class="si">}</span><span class="s2">,  CpS = </span><span class="si">{</span><span class="n">CpS</span><span class="si">}</span><span class="s2">,   Ua = </span><span class="si">{</span><span class="n">Ua</span><span class="si">}</span><span class="s2">,  Ub = </span><span class="si">{</span><span class="n">Ub</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">model_energy_second_order</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CpH = 2.1819127156760283,  CpS = 1.878312055293452,   Ua = 0.04956661570349656,  Ub = 0.021187799850674392
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time
0.0     -0.221000
10.0     0.104481
20.0     0.063797
30.0    -0.007664
40.0    -0.117127
           ...   
560.0   -0.289049
570.0   -0.245878
580.0   -0.203222
590.0   -0.386367
600.0    0.039925
Name: T1, Length: 61, dtype: float64
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_27_2.png" src="../_images/02.04-Model-Identification_27_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="fourth-order-multi-input-multi-output-model">
<h2><span class="section-number">2.4.7. </span>Fourth-Order Multi-Input Multi-Output Model<a class="headerlink" href="#fourth-order-multi-input-multi-output-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="model-derivation">
<h3><span class="section-number">2.4.7.1. </span>Model derivation<a class="headerlink" href="#model-derivation" title="Permalink to this headline">¶</a></h3>
<p>\begin{align}
C^H_p\frac{dT_{H,1}}{dt} &amp; = U_a(T_{amb} - T_{H,1}) + U_b(T_{S,1} - T_{H,1}) + U_c(T_{H,2}-T_{H,1})  + \alpha P_1u_1\
C^S_p\frac{dT_{S,1}}{dt} &amp; = U_b(T_{H,1} - T_{S,1})  \
C^H_p\frac{dT_{H,2}}{dt} &amp; = U_a(T_{amb} - T_{H,2}) + U_b(T_{S,2} - T_{H,2}) + U_c(T_{H,1}-T_{H,2}) + \alpha P_2 u_2\
C^S_p\frac{dT_{S,2}}{dt} &amp; = U_b(T_{H,2} - T_{S,2})
\end{align}</p>
<p>where</p>
<p>\begin{align}
T_1 &amp; = T_{S,1} \
T_2 &amp; = T_{S,2}
\end{align}</p>
</div>
<div class="section" id="standard-form">
<h3><span class="section-number">2.4.7.2. </span>Standard form<a class="headerlink" href="#standard-form" title="Permalink to this headline">¶</a></h3>
<p>\begin{align}
\frac{dT_{H,1}}{dt} &amp; = -(\frac{U_a+U_b+U_c}{C^H_p})T_{H,1} + \frac{U_b}{C^H_p}T_{S,1} + \frac{U_c}{C^H_p}T_{H,2}  + \frac{\alpha P_1}{C^H_p}u_1 + \frac{U_a}{C^H_p}T_{amb}\
\frac{dT_{S,1}}{dt} &amp; = \frac{U_b}{C^S_p}(T_{H,1} - T_{S,1})  \
\frac{dT_{H,2}}{dt} &amp; = -(\frac{U_a+U_b+U_c}{C^H_p})T_{H,2} + \frac{U_b}{C^H_p}T_{S,2} + \frac{U_c}{C^H_p}T_{H,1}  + \frac{\alpha P_2}{C^H_p}u_2 + \frac{U_a}{C^H_p}T_{amb}\
\frac{dT_{S,2}}{dt} &amp; = \frac{U_b}{C^S_p}(T_{H,2} - T_{S,2})
\end{align}</p>
<p>where</p>
<p>\begin{align}
T_1 &amp; = T_{S,1} \
T_2 &amp; = T_{S,2}
\end{align}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>

<span class="c1"># adjustable parameters</span>
<span class="n">CpH</span> <span class="o">=</span> <span class="mi">5</span>                <span class="c1"># joules/deg C</span>
<span class="n">CpS</span> <span class="o">=</span> <span class="mi">1</span>                <span class="c1"># joules/deg C</span>
<span class="n">Ua</span> <span class="o">=</span> <span class="mf">0.05</span>              <span class="c1"># watts/deg C</span>
<span class="n">Ub</span> <span class="o">=</span> <span class="mf">0.05</span>              <span class="c1"># watts/deg C</span>
<span class="n">Uc</span> <span class="o">=</span> <span class="mf">0.05</span>              <span class="c1"># watts/deg C</span>

<span class="k">def</span> <span class="nf">model_energy_fourth_order</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># unpack the adjustable parameters</span>
    <span class="n">CpH</span><span class="p">,</span> <span class="n">CpS</span><span class="p">,</span> <span class="n">Ua</span><span class="p">,</span> <span class="n">Ub</span><span class="p">,</span> <span class="n">Uc</span> <span class="o">=</span> <span class="n">param</span>  

    <span class="c1"># model solution</span>
    <span class="k">def</span> <span class="nf">deriv</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">T1H</span><span class="p">,</span> <span class="n">T1S</span><span class="p">,</span> <span class="n">T2H</span><span class="p">,</span> <span class="n">T2S</span><span class="o">=</span> <span class="n">y</span>
        <span class="n">dT1H</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ua</span> <span class="o">+</span> <span class="n">Ub</span> <span class="o">+</span> <span class="n">Uc</span><span class="p">)</span><span class="o">*</span><span class="n">T1H</span> <span class="o">+</span> <span class="n">Ub</span><span class="o">*</span><span class="n">T1S</span> <span class="o">+</span> <span class="n">Uc</span><span class="o">*</span><span class="n">T2H</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">P1</span><span class="o">*</span><span class="n">u1</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">Ua</span><span class="o">*</span><span class="n">T_amb</span><span class="p">)</span><span class="o">/</span><span class="n">CpH</span>
        <span class="n">dT1S</span> <span class="o">=</span> <span class="n">Ub</span><span class="o">*</span><span class="p">(</span><span class="n">T1H</span> <span class="o">-</span> <span class="n">T1S</span><span class="p">)</span><span class="o">/</span><span class="n">CpS</span>
        <span class="n">dT2H</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">Ua</span> <span class="o">+</span> <span class="n">Ub</span> <span class="o">+</span> <span class="n">Uc</span><span class="p">)</span><span class="o">*</span><span class="n">T2H</span> <span class="o">+</span> <span class="n">Ub</span><span class="o">*</span><span class="n">T2S</span> <span class="o">+</span> <span class="n">Uc</span><span class="o">*</span><span class="n">T1H</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">P2</span><span class="o">*</span><span class="n">u2</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">Ua</span><span class="o">*</span><span class="n">T_amb</span><span class="p">)</span><span class="o">/</span><span class="n">CpH</span>
        <span class="n">dT2S</span> <span class="o">=</span> <span class="n">Ub</span><span class="o">*</span><span class="p">(</span><span class="n">T2H</span> <span class="o">-</span> <span class="n">T2S</span><span class="p">)</span><span class="o">/</span><span class="n">CpS</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">dT1H</span><span class="p">,</span> <span class="n">dT1S</span><span class="p">,</span> <span class="n">dT2H</span><span class="p">,</span> <span class="n">dT2S</span><span class="p">]</span>

    <span class="n">soln</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">deriv</span><span class="p">,</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">t_expt</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">t_expt</span><span class="p">)],</span> <span class="p">[</span><span class="n">T_amb</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">t_expt</span><span class="p">)</span> 
    
    <span class="c1"># create dataframe with predictions</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">,</span> <span class="s2">&quot;T2&quot;</span><span class="p">,</span> <span class="s2">&quot;Q1&quot;</span><span class="p">,</span> <span class="s2">&quot;Q2&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">t_expt</span><span class="p">)</span>
    <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="c1"># plot solution</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_data</span><span class="p">(</span><span class="n">expt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
    
    <span class="n">err1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">])</span>
    <span class="n">err2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="s2">&quot;T2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">expt</span><span class="p">[</span><span class="s2">&quot;T2&quot;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">err1</span><span class="p">,</span> <span class="n">err2</span><span class="p">))</span>
    
<span class="n">model_energy_fourth_order</span><span class="p">([</span><span class="n">CpH</span><span class="p">,</span> <span class="n">CpS</span><span class="p">,</span> <span class="n">Ua</span><span class="p">,</span> <span class="n">Ub</span><span class="p">,</span> <span class="n">Uc</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ -0.221     ,   0.34640496,   0.76940428,   1.05824442,
         1.13171249,   1.24645305,   1.07316775,   0.81586616,
         0.48007917,  -0.13344645,  -0.48890253,  -0.70921588,
        -1.25124638,  -1.76745403,  -2.20823788,  -2.69742627,
        -3.14122854,  -3.52330422,  -4.01831601,  -4.40206324,
        -4.88886002,  -5.19721912,  -5.48385191,  -5.96815841,
        -6.40553965,  -6.57439776,  -6.70435903,  -6.9013846 ,
        -7.2455444 ,  -7.69003022,  -7.92579427,  -8.09662387,
        -8.30244458,  -8.28467125,  -8.45397113,  -8.44203263,
        -8.55229841,  -8.76329137,  -8.79264212,  -8.97090733,
        -9.05270848,  -9.21073629,  -9.11325468,  -9.42975647,
        -9.44638557,  -9.61415333,  -9.564619  ,  -9.87641255,
       -10.01102868,  -9.74099527,  -9.82511837,  -9.804095  ,
       -10.08438906, -10.11845575, -10.39033103, -10.67585924,
       -10.64774194, -10.64625393, -10.63882106, -10.84765596,
       -10.44699971,  -0.446     ,  -0.48503157,  -0.44947717,
        -0.33520192,  -0.25415283,  -0.1348096 ,   0.0347824 ,
         0.13562221,   0.28798863,   0.38045703,   0.27346487,
         0.35047914,   0.34883465,   0.29794038,   0.25683209,
         0.12771424,   0.13995666,  -0.08773217,  -0.13871927,
        -0.18724166,  -0.46082221,  -0.63253118,  -0.84498618,
        -0.98516443,  -1.17491935,  -1.33677645,  -1.49587723,
        -1.8492109 ,  -1.96193909,  -1.99769309,  -2.25902565,
        -2.50785808,  -2.61676844,  -2.80891642,  -2.99064871,
        -3.17264735,  -3.21202536,  -3.45674232,  -3.57654781,
        -3.68625433,  -3.83610915,  -3.81942424,  -4.06981347,
        -4.11040659,  -4.07154664,  -4.2405798 ,  -4.40609913,
        -4.60440012,  -4.66476863,  -4.65018425,  -4.83416322,
        -4.9332353 ,  -4.99274741,  -4.94824326,  -5.08791481,
        -5.21768802,  -5.27702057,  -5.31165008,  -5.25854906,
        -5.50630469,  -5.43159342])
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_31_1.png" src="../_images/02.04-Model-Identification_31_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">model_energy_fourth_order</span><span class="p">,</span>  <span class="p">[</span><span class="n">CpH</span><span class="p">,</span> <span class="n">CpS</span><span class="p">,</span> <span class="n">Ua</span><span class="p">,</span> <span class="n">Ub</span><span class="p">,</span> <span class="n">Uc</span><span class="p">])</span>
<span class="n">CpH</span><span class="p">,</span> <span class="n">CpS</span><span class="p">,</span> <span class="n">Ua</span><span class="p">,</span> <span class="n">Ub</span><span class="p">,</span> <span class="n">Uc</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">x</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CpH = </span><span class="si">{</span><span class="n">CpH</span><span class="si">}</span><span class="s2">,  CpS = </span><span class="si">{</span><span class="n">CpS</span><span class="si">}</span><span class="s2">,   Ua = </span><span class="si">{</span><span class="n">Ua</span><span class="si">}</span><span class="s2">,  Ub = </span><span class="si">{</span><span class="n">Ub</span><span class="si">}</span><span class="s2">,  Uc = </span><span class="si">{</span><span class="n">Uc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">model_energy_fourth_order</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CpH = 4.4642229433310705,  CpS = 0.8190620772014501,   Ua = 0.032226735496058236,  Ub = 0.01862452210295832,  Uc = 0.033554024370968105
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-0.221     ,  0.10032875,  0.05752008, -0.00405231, -0.10773464,
        0.01920575,  0.02181627,  0.03268211,  0.05934022, -0.12621606,
       -0.02560712,  0.22155593,  0.1591108 ,  0.12013875,  0.14267453,
        0.09875163,  0.08540225,  0.13037096,  0.05135871,  0.04902892,
       -0.09703112, -0.09303583, -0.06500128, -0.20674525, -0.32566391,
       -0.22615469, -0.12616143, -0.08732116, -0.16917961, -0.37119119,
       -0.39871904, -0.38303497, -0.3863195 , -0.15266185, -0.13605994,
        0.01670928,  0.02122981, -0.05314745,  0.08779108,  0.06239935,
        0.09510954,  0.02842961,  0.244774  ,  0.09824684,  0.2274448 ,
        0.14545713,  0.23302579, -0.01549275, -0.04315274,  0.31607625,
        0.29086137,  0.36550651,  0.18295226,  0.25477598,  0.05819174,
       -0.19055652, -0.12624109, -0.06348875, -0.00238632, -0.16838589,
        0.27369513, -0.446     , -0.50119113, -0.51353834, -0.49453376,
       -0.52704126, -0.5249296 , -0.46191438, -0.43668769, -0.33177506,
       -0.25803356, -0.35343691, -0.23397058, -0.16735761, -0.12678506,
       -0.05492989, -0.05271973,  0.10466706,  0.0275704 ,  0.13124193,
        0.25303202,  0.16776558,  0.19461196,  0.17308493,  0.19904272,
        0.17668492,  0.20215753,  0.24412295,  0.07539325,  0.11601581,
        0.23727338,  0.14868402,  0.07800115,  0.12121353,  0.05554524,
        0.01045571, -0.01114647,  0.12013079,  0.01510873, -0.00699348,
       -0.01320108, -0.03383083,  0.12440592, -0.01963049, -0.01180309,
        0.08812169,  0.02647401,  0.00262072, -0.08701869, -0.08883899,
       -0.00579806, -0.09870102, -0.10820023, -0.12779525, -0.05783289,
       -0.14850718, -0.19822316, -0.18305994, -0.17332694, -0.07350994,
       -0.26875958, -0.14489134])
</pre></div>
</div>
<img alt="../_images/02.04-Model-Identification_32_2.png" src="../_images/02.04-Model-Identification_32_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="lab-assignment-2-identification-of-a-multi-input-multi-output-model-for-the-temperature-control-laboratory">
<h2><span class="section-number">2.4.8. </span>Lab Assignment 2: Identification of a Multi-input, Multi-output Model for the Temperature Control Laboratory<a class="headerlink" href="#lab-assignment-2-identification-of-a-multi-input-multi-output-model-for-the-temperature-control-laboratory" title="Permalink to this headline">¶</a></h2>
<p>Create one or more notebooks to show your results for the following exercises. The model you develop in this exercise will be used in the remainder of the semester for simulation and control design for your copy of the Temperature Control Laboratory.</p>
<div class="section" id="exercise-1">
<h3><span class="section-number">2.4.8.1. </span>Exercise 1.<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h3>
<p>Write two python functions, one called u1(t) and the other u2(t), that create the following input signals that will be used to test the Temperature Control Lab.</p>
<ul class="simple">
<li><p>u1(t) and u2(t) are initially zero.</p></li>
<li><p>At time t=20, u1(t) jumps to 60% power, u2(t) remains at zero.</p></li>
<li><p>At time t=620, u2(t) jumps to 60% power, u1(t) remains at 60.</p></li>
<li><p>At time t=1020, u1(t) returns to 0, u2(t) remains at 60.</p></li>
<li><p>At time t=1420, u2(t) returns to zero. Experiment is over.</p></li>
</ul>
<p>Develop these functions, and plot the results for t=-100 to t=1800 (yes, beyond the end of the experiment) showing correct performance.</p>
</div>
<div class="section" id="exercise-2">
<h3><span class="section-number">2.4.8.2. </span>Exercise 2.<a class="headerlink" href="#exercise-2" title="Permalink to this headline">¶</a></h3>
<p>Use the functions created in Exercise 1 to obtain experimental data for your Temperature Control Lab. This will take some time (about 1/2 hour if everything works perfectly). Record T1, T2, Q1, Q2 using the Historian. Be careful to …</p>
<ul class="simple">
<li><p>Set P1=200, P2=100 before the experiment begins</p></li>
<li><p>Let the device reach equilibrium with ambient temperture before starting. Allow at least 10 minutes. Don’t shortcut this (as tempting as that may be) since you will only get data that provide headaches later. “Go slow to go fast.”</p></li>
<li><p>You might use the box the kit came in to put a little “tent” over the device to protect from air currents.</p></li>
<li><p>Before starting, be sure the heat sinks are not touching, and that everything looks in good shape.</p></li>
<li><p>If your thermal paste looks like it is melting, stop the experiment immediately. Lower P1 and P2 by 25% and start over. Note this in your lab report.</p></li>
</ul>
<p>Save this data to a .csv file.</p>
</div>
<div class="section" id="exercise-3">
<h3><span class="section-number">2.4.8.3. </span>Exercise 3.<a class="headerlink" href="#exercise-3" title="Permalink to this headline">¶</a></h3>
<p>To avoid overwriting or damaging the data you collected in Exercise 2, create a separate notebook for model fitting. Fit two models to your data:</p>
<ul class="simple">
<li><p>Fit the first-order plus delay model to the results for “T1” using data up to t=620 (i.e, the data before you turn on the second heater.).  What are the gain, time-constant, and time delay for your device?</p></li>
<li><p>Fit the fourth-order model (alternatively, the state-space model if you’re comfortable with that formulation), and report all heat capacities, heat transfer coefficients. Note that you’re fitting a two-input, two-output model which is very challenging. So the fit may not look quite as good as those shown above when u2(t) was held constant.</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="02.03-First-Order-Model-for-a-Single-Heater.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">2.3. </span>First Order Model for a Single Heater</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03.00-Feedback-Control.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Feedback Control</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Jeffrey Kantor<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>